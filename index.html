<!DOCTYPE html>
<html lang="hr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kalendar i Upravljanje Zadacima</title>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* Globalni stilovi */
    :root {
      --primary-color: #6B46C1;
      --primary-hover: #553C9A;
      --secondary-color: #4299E1;
      --success-color: #48BB78;
      --warning-color: #ED8936;
      --danger-color: #F56565;
      --light-gray: #f8f9fa;
      --dark-gray: #343a40;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --shadow-hover: 0 6px 8px rgba(0, 0, 0, 0.15);
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Arial', sans-serif;
      padding: 20px;
      background: #f0f2f5;
      margin: 0;
      min-height: 100vh;
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    /* Glavni kontejner */
    .main-container {
      display: flex;
      gap: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Sidebar */
    .sidebar {
      flex: 0 0 280px;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      display: flex;
      flex-direction: column;
    }

    .sidebar h2 {
      margin-top: 0;
      margin-bottom: 25px;
      color: var(--dark-gray);
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 2px solid var(--light-gray);
      padding-bottom: 15px;
    }

    .sidebar-buttons {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 30px;
    }

    .sidebar-btn {
      padding: 14px 20px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
      text-align: left;
      font-size: 1rem;
    }

    .sidebar-btn:hover {
      background: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    .sidebar-btn i {
      font-size: 1.2rem;
    }

    .quick-overview {
      margin-top: auto;
      background: var(--light-gray);
      padding: 20px;
      border-radius: 8px;
    }

    .quick-overview h3 {
      margin-top: 0;
      margin-bottom: 20px;
      color: var(--dark-gray);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .overview-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #ddd;
    }

    .overview-item:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }

    .overview-label {
      color: var(--dark-gray);
      font-weight: 500;
    }

    .overview-value {
      font-weight: 700;
      font-size: 1.2rem;
      color: var(--primary-color);
    }

    /* Kalendar stilovi */
    .calendar {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      flex: 1;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .calendar-header h2 {
      margin: 0;
      font-size: 1.5rem;
      color: var(--dark-gray);
      transition: color 0.3s ease;
    }
    
    .header-controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    
    #darkModeToggle {
      background: transparent;
      border: none;
      color: var(--primary-color);
      font-size: 1.2rem;
      cursor: pointer;
      transition: transform 0.3s ease, color 0.3s ease;
      padding: 8px;
    }
    
    #darkModeToggle:hover {
      transform: rotate(20deg);
    }
    
    .calendar-header button {
      background: var(--primary-color);
      border: none;
      color: white;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .calendar-header button:hover {
      background: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    
    th, td {
      padding: 15px;
      border: 1px solid #e9ecef;
      text-align: center;
      cursor: pointer;
      transition: var(--transition);
    }
    
    th {
      background-color: var(--primary-color);
      color: white;
      font-weight: 500;
    }
    
    td {
      background-color: white;
      transition: background-color 0.3s ease, transform 0.3s ease;
    }
    
    td:hover {
      background-color: var(--light-gray);
      transform: scale(1.02);
    }

    .has-entry {
      background-color: #e3f2fd !important;
      position: relative;
    }
    
    .has-entry::after {
      content: '';
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 6px;
      background-color: var(--primary-color);
      border-radius: 50%;
    }

    /* Dugmad ispod kalendara */
    .calendar-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    .calendar-actions button {
      padding: 10px 20px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      flex: 1;
    }
    
    .calendar-actions button:hover {
      background: var(--primary-hover);
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    /* Modal za zadatke */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      overflow-y: auto;
    }

    .modal-content {
      background: white;
      margin: 50px auto;
      padding: 30px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      max-width: 800px;
      width: 95%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      transition: background-color 0.3s ease;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--light-gray);
    }

    .modal-header h2 {
      margin: 0;
      color: var(--dark-gray);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .close-modal {
      background: transparent;
      border: none;
      font-size: 1.8rem;
      color: var(--dark-gray);
      cursor: pointer;
      transition: var(--transition);
      padding: 5px;
    }

    .close-modal:hover {
      color: var(--danger-color);
      transform: rotate(90deg);
    }

    /* Forma za dodavanje zadataka */
    .task-form {
      background: var(--light-gray);
      padding: 25px;
      border-radius: 8px;
      margin-bottom: 25px;
    }

    .form-row {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      flex: 1;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--dark-gray);
      font-weight: 500;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background: white;
      color: var(--dark-gray);
      font-size: 1rem;
      transition: var(--transition);
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(107, 70, 193, 0.1);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }

    .priority-badges {
      display: flex;
      gap: 10px;
      margin-top: 5px;
    }

    .priority-badge {
      flex: 1;
      text-align: center;
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: var(--transition);
      font-weight: 500;
    }

    .priority-badge.low {
      background: #E6FFFA;
      color: #234E52;
      border-color: #E6FFFA;
    }

    .priority-badge.medium {
      background: #EBF8FF;
      color: #2C5282;
      border-color: #EBF8FF;
    }

    .priority-badge.high {
      background: #FFF5F5;
      color: #97266D;
      border-color: #FFF5F5;
    }

    .priority-badge.active {
      border-color: var(--primary-color);
    }

    .priority-badge:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    .form-actions {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      margin-top: 20px;
    }

    .form-actions button {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Lista zadataka */
    .tasks-list {
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid #eee;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
    }

    .task-item {
      background: white;
      border-left: 4px solid var(--primary-color);
      padding: 20px;
      margin-bottom: 15px;
      border-radius: 8px;
      box-shadow: var(--shadow);
      transition: var(--transition);
    }

    .task-item:hover {
      transform: translateX(5px);
      box-shadow: var(--shadow-hover);
    }

    .task-item.completed {
      opacity: 0.8;
      border-left-color: var(--success-color);
    }

    .task-header-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .task-title {
      font-weight: 600;
      color: var(--dark-gray);
      margin: 0;
      font-size: 1.1rem;
      flex: 1;
    }

    .task-meta {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }

    .task-priority {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
      white-space: nowrap;
    }

    .task-priority.low {
      background: #C6F6D5;
      color: #22543D;
    }

    .task-priority.medium {
      background: #BEE3F8;
      color: #2A4365;
    }

    .task-priority.high {
      background: #FED7D7;
      color: #742A2A;
    }

    .task-date {
      color: #718096;
      font-size: 0.9rem;
      white-space: nowrap;
    }

    .task-description {
      color: var(--dark-gray);
      margin: 15px 0;
      line-height: 1.6;
      padding: 10px;
      background: #f9f9f9;
      border-radius: 6px;
    }

    .task-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }

    .task-actions button {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: var(--transition);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .task-actions .complete-btn {
      background: var(--success-color);
      color: white;
    }

    .task-actions .edit-btn {
      background: var(--secondary-color);
      color: white;
    }

    .task-actions .delete-btn {
      background: var(--danger-color);
      color: white;
    }

    .task-actions button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    .no-tasks {
      text-align: center;
      padding: 40px 20px;
      color: #718096;
      font-style: italic;
    }

    /* Statistika modal */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-top: 20px;
    }

    .stat-card {
      background: var(--light-gray);
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
    }

    .stat-card h3 {
      margin: 0 0 10px 0;
      font-size: 1rem;
      color: var(--dark-gray);
    }

    .stat-card p {
      margin: 0;
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary-color);
    }

    .priority-stats {
      margin-top: 30px;
    }

    .priority-bar {
      height: 30px;
      border-radius: 15px;
      margin-bottom: 10px;
      overflow: hidden;
      position: relative;
    }

    .priority-bar.low {
      background: #C6F6D5;
    }

    .priority-bar.medium {
      background: #BEE3F8;
    }

    .priority-bar.high {
      background: #FED7D7;
    }

    .priority-label {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      font-weight: 600;
      color: #333;
      z-index: 1;
    }

    /* Dark Mode stilovi */
    body.dark-mode {
      background: #121212;
      color: #e0e0e0;
    }

    body.dark-mode .sidebar,
    body.dark-mode .calendar {
      background: #1e1e1e;
      color: #e0e0e0;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    body.dark-mode th {
      background-color: #3700B3;
    }

    body.dark-mode td {
      background-color: #2d2d2d;
      border-color: #444;
    }

    body.dark-mode td:hover {
      background-color: #3d3d3d;
    }

    body.dark-mode .has-entry {
      background-color: #0d47a1 !important;
    }

    body.dark-mode #darkModeToggle {
      color: #bb86fc;
    }

    body.dark-mode .calendar-header h2,
    body.dark-mode .sidebar h2 {
      color: #e0e0e0;
    }

    body.dark-mode .modal-content {
      background: #1e1e1e;
      color: #e0e0e0;
    }

    body.dark-mode .task-form {
      background: #252525;
    }

    body.dark-mode .form-group input,
    body.dark-mode .form-group textarea {
      background: #333;
      border-color: #444;
      color: #e0e0e0;
    }

    body.dark-mode .form-group input:focus,
    body.dark-mode .form-group textarea:focus {
      border-color: #bb86fc;
      box-shadow: 0 0 0 3px rgba(187, 134, 252, 0.1);
    }

    body.dark-mode .task-item {
      background: #2d2d2d;
    }

    body.dark-mode .task-description {
      background: #252525;
      color: #e0e0e0;
    }

    body.dark-mode .tasks-list {
      border-color: #444;
    }

    body.dark-mode .quick-overview {
      background: #252525;
    }

    body.dark-mode .overview-item {
      border-bottom-color: #444;
    }

    body.dark-mode .priority-badge.low {
      background: #1B4332;
      color: #95D5B2;
      border-color: #1B4332;
    }

    body.dark-mode .priority-badge.medium {
      background: #1E3A8A;
      color: #93C5FD;
      border-color: #1E3A8A;
    }

    body.dark-mode .priority-badge.high {
      background: #7B341E;
      color: #FEB2B2;
      border-color: #7B341E;
    }

    body.dark-mode .task-priority.low {
      background: #22543D;
      color: #9AE6B4;
    }

    body.dark-mode .task-priority.medium {
      background: #2A4365;
      color: #90CDF4;
    }

    body.dark-mode .task-priority.high {
      background: #742A2A;
      color: #FC8181;
    }

    body.dark-mode .stat-card {
      background: #252525;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .main-container {
        flex-direction: column;
      }
      
      .sidebar {
        flex: none;
        width: 100%;
      }
    }

    @media (max-width: 768px) {
      .calendar {
        padding: 15px;
      }
      
      .calendar-header {
        flex-direction: column;
        gap: 15px;
      }
      
      .header-controls {
        width: 100%;
        justify-content: space-between;
      }
      
      th, td {
        padding: 10px;
        font-size: 0.9rem;
      }
      
      .modal-content {
        padding: 20px;
        margin: 20px auto;
        width: 98%;
      }
      
      .form-row {
        flex-direction: column;
      }
      
      .task-header-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .task-meta {
        width: 100%;
        justify-content: space-between;
      }
      
      .task-actions {
        width: 100%;
        justify-content: flex-start;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- SIDEBAR -->
    <div class="sidebar">
      <h2><i class="fas fa-calendar-alt"></i> Kalendar</h2>
      
      <div class="sidebar-buttons">
        <button class="sidebar-btn" onclick="openTaskModal()">
          <i class="fas fa-tasks"></i> TASK
        </button>
        <button class="sidebar-btn" onclick="showAllTasks()">
          <i class="fas fa-list"></i> Svi zadatci
        </button>
        <button class="sidebar-btn" onclick="showStatistics()">
          <i class="fas fa-chart-bar"></i> Statistika
        </button>
      </div>
      
      <div class="quick-overview">
        <h3><i class="fas fa-eye"></i> Brzi pregled</h3>
        <div class="overview-item">
          <span class="overview-label">Danas:</span>
          <span class="overview-value" id="todayCount">0</span>
        </div>
        <div class="overview-item">
          <span class="overview-label">Sedmica:</span>
          <span class="overview-value" id="weekCount">0</span>
        </div>
        <div class="overview-item">
          <span class="overview-label">Mjesec:</span>
          <span class="overview-value" id="monthCount">0</span>
        </div>
        <div class="overview-item">
          <span class="overview-label">Ukupno:</span>
          <span class="overview-value" id="totalCount">0</span>
        </div>
      </div>
    </div>

    <!-- KALENDAR -->
    <div class="calendar">
      <div class="calendar-header">
        <button onclick="prevMonth()">
          <i class="fas fa-chevron-left"></i> Prev
        </button>
        <h2 id="monthYear"></h2>
        <div class="header-controls">
          <button id="darkModeToggle" onclick="toggleDarkMode()">
            <i class="fas fa-moon"></i>
          </button>
          <button onclick="nextMonth()">
            Next <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
      <table>
        <thead>
          <tr>
            <th>Pon</th>
            <th>Uto</th>
            <th>Sri</th>
            <th>Čet</th>
            <th>Pet</th>
            <th>Sub</th>
            <th>Ned</th>
          </tr>
        </thead>
        <tbody id="calendarBody"></tbody>
      </table>
      <div class="calendar-actions">
        <button id="pdfButton" onclick="exportMonthPDF()">
          <i class="fas fa-file-pdf"></i> Export Month PDF
        </button>
        <button id="clearAllButton" onclick="clearAllMonth()">
          <i class="fas fa-trash-alt"></i> Clear All Tasks
        </button>
      </div>
    </div>
  </div>

  <!-- MODAL ZA DODAVANJE ZADATAKA -->
  <div class="modal" id="taskModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-plus-circle"></i> Dodaj Novi Zadatak</h2>
        <button class="close-modal" onclick="closeTaskModal()">&times;</button>
      </div>

      <!-- Forma za dodavanje zadataka -->
      <div class="task-form">
        <div class="form-row">
          <div class="form-group">
            <label>Naslov zadatka:</label>
            <input type="text" id="taskTitle" placeholder="Unesi naslov zadatka">
          </div>
          <div class="form-group">
            <label>Datum izvršenja:</label>
            <input type="date" id="taskDate">
          </div>
        </div>
        <div class="form-group">
          <label>Opis zadatka:</label>
          <textarea id="taskDescription" placeholder="Unesi detaljan opis zadatka..."></textarea>
        </div>
        <div class="form-group">
          <label>Prioritet zadatka:</label>
          <div class="priority-badges">
            <div class="priority-badge low" onclick="setPriority('low')">Nizak</div>
            <div class="priority-badge medium active" onclick="setPriority('medium')">Srednji</div>
            <div class="priority-badge high" onclick="setPriority('high')">Visok</div>
          </div>
        </div>
        <div class="form-actions">
          <button onclick="closeTaskModal()" style="background: var(--danger-color);">
            <i class="fas fa-times"></i> Zatvori
          </button>
          <button onclick="saveTask()" style="background: var(--success-color);">
            <i class="fas fa-plus"></i> ADD
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL ZA PRIKAZ ZADATAKA ZA DATUM -->
  <div class="modal" id="dateTasksModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-calendar-day"></i> Zadaci za <span id="selectedDateText"></span></h2>
        <button class="close-modal" onclick="closeDateTasksModal()">&times;</button>
      </div>

      <div class="tasks-list" id="dateTasksList">
        <!-- Zadaci će se dinamički dodavati ovdje -->
      </div>
    </div>
  </div>

  <!-- MODAL ZA SVE ZADATKE -->
  <div class="modal" id="allTasksModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-list"></i> Svi Zadaci</h2>
        <button class="close-modal" onclick="closeAllTasksModal()">&times;</button>
      </div>

      <div class="tasks-list" id="allTasksList">
        <!-- Svi zadaci će se dinamički dodavati ovdje -->
      </div>
    </div>
  </div>

  <!-- MODAL ZA STATISTIKU -->
  <div class="modal" id="statsModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2><i class="fas fa-chart-bar"></i> Statistika</h2>
        <button class="close-modal" onclick="closeStatsModal()">&times;</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <h3>Ukupno zadataka</h3>
          <p id="statsTotal">0</p>
        </div>
        <div class="stat-card">
          <h3>Završeni zadaci</h3>
          <p id="statsCompleted">0</p>
        </div>
        <div class="stat-card">
          <h3>Aktivni zadaci</h3>
          <p id="statsActive">0</p>
        </div>
        <div class="stat-card">
          <h3>Zadaci ovog mjeseca</h3>
          <p id="statsMonth">0</p>
        </div>
      </div>

      <div class="priority-stats">
        <h3>Raspodjela po prioritetu</h3>
        <div class="priority-bar low">
          <span class="priority-label">Nizak: <span id="lowCount">0</span></span>
        </div>
        <div class="priority-bar medium">
          <span class="priority-label">Srednji: <span id="mediumCount">0</span></span>
        </div>
        <div class="priority-bar high">
          <span class="priority-label">Visok: <span id="highCount">0</span></span>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Glavne varijable
    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    let notes = JSON.parse(localStorage.getItem('notes')) || [];
    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    let currentPriority = 'medium';
    let editingTaskId = null;
    let selectedDate = null;

    // Inicijalizacija
    document.addEventListener('DOMContentLoaded', function() {
      initDarkMode();
      generateCalendar();
      updateQuickOverview();
      document.getElementById('taskDate').valueAsDate = new Date();
    });

    // Dark Mode funkcije
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    function initDarkMode() {
      const darkMode = localStorage.getItem('darkMode') === 'true';
      if (darkMode) {
        document.body.classList.add('dark-mode');
      }
    }

    // Generisanje kalendara
    function generateCalendar() {
      const calendarBody = document.getElementById('calendarBody');
      const monthYear = document.getElementById('monthYear');
      calendarBody.innerHTML = '';

      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const adjustedFirstDay = (firstDay + 6) % 7;
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

      monthYear.textContent = `${new Date(currentYear, currentMonth).toLocaleString('hr-HR', { month: 'long' })} ${currentYear}`;
      let day = 1;

      for (let i = 0; i < 6; i++) {
        const row = document.createElement('tr');
        for (let j = 0; j < 7; j++) {
          const cell = document.createElement('td');
          if ((i === 0 && j < adjustedFirstDay) || day > daysInMonth) {
            cell.textContent = '';
          } else {
            cell.textContent = day;
            const cellDay = day;
            const cellDate = new Date(currentYear, currentMonth, cellDay);

            // Provjeri ima li zadataka za ovaj dan
            if (tasks.some(t => isSameDay(new Date(t.date), cellDate))) {
              cell.classList.add('has-entry');
            }

            // Dodaj event listener za klik na dan
            cell.onclick = () => showTasksForDate(cellDate);
            day++;
          }
          row.appendChild(cell);
        }
        calendarBody.appendChild(row);
      }
    }

    // Navigacija kalendarom
    function nextMonth() {
      if (currentMonth === 11) {
        currentMonth = 0;
        currentYear++;
      } else {
        currentMonth++;
      }
      generateCalendar();
      updateQuickOverview();
    }

    function prevMonth() {
      if (currentMonth === 0) {
        currentMonth = 11;
        currentYear--;
      } else {
        currentMonth--;
      }
      generateCalendar();
      updateQuickOverview();
    }

    // Modal funkcije
    function openTaskModal() {
      document.getElementById('taskModal').style.display = 'block';
      clearTaskForm();
    }

    function closeTaskModal() {
      document.getElementById('taskModal').style.display = 'none';
      editingTaskId = null;
      document.querySelector('.form-actions button:last-child').innerHTML = '<i class="fas fa-plus"></i> ADD';
      clearTaskForm();
    }

    function closeDateTasksModal() {
      document.getElementById('dateTasksModal').style.display = 'none';
    }

    function closeAllTasksModal() {
      document.getElementById('allTasksModal').style.display = 'none';
    }

    function closeStatsModal() {
      document.getElementById('statsModal').style.display = 'none';
    }

    // Funkcije za zadatke
    function setPriority(priority) {
      currentPriority = priority;
      document.querySelectorAll('.priority-badge').forEach(badge => {
        badge.classList.remove('active');
      });
      document.querySelector(`.priority-badge.${priority}`).classList.add('active');
    }

    function saveTask() {
      const title = document.getElementById('taskTitle').value.trim();
      const date = document.getElementById('taskDate').value;
      const description = document.getElementById('taskDescription').value.trim();

      if (!title || !date) {
        alert('Molimo unesite naslov i datum zadatka!');
        return;
      }

      const task = {
        id: editingTaskId || Date.now(),
        title,
        date,
        description,
        priority: currentPriority,
        completed: false,
        createdAt: new Date().toISOString()
      };

      if (editingTaskId) {
        // Ažuriranje postojećeg zadatka
        const index = tasks.findIndex(t => t.id === editingTaskId);
        if (index !== -1) {
          tasks[index] = task;
        }
      } else {
        // Dodavanje novog zadatka
        tasks.push(task);
      }

      saveTasks();
      closeTaskModal();
      generateCalendar();
      updateQuickOverview();
      
      // Ako je otvoren modal za prikaz zadataka za datum, osvježi ga
      if (selectedDate) {
        showTasksForDate(selectedDate);
      }
    }

    function clearTaskForm() {
      document.getElementById('taskTitle').value = '';
      document.getElementById('taskDate').valueAsDate = new Date();
      document.getElementById('taskDescription').value = '';
      setPriority('medium');
    }

    function editTask(id) {
      const task = tasks.find(t => t.id === id);
      if (task) {
        document.getElementById('taskTitle').value = task.title;
        document.getElementById('taskDate').value = task.date;
        document.getElementById('taskDescription').value = task.description || '';
        setPriority(task.priority);
        editingTaskId = task.id;
        
        document.querySelector('.form-actions button:last-child').innerHTML = '<i class="fas fa-save"></i> Sačuvaj';
        closeDateTasksModal();
        openTaskModal();
      }
    }

    function deleteTask(id) {
      if (confirm('Da li ste sigurni da želite obrisati ovaj zadatak?')) {
        tasks = tasks.filter(t => t.id !== id);
        saveTasks();
        
        // Osvježi prikaz ako je otvoren neki modal
        if (selectedDate) {
          showTasksForDate(selectedDate);
        }
        
        generateCalendar();
        updateQuickOverview();
      }
    }

    function toggleTaskComplete(id) {
      const task = tasks.find(t => t.id === id);
      if (task) {
        task.completed = !task.completed;
        saveTasks();
        
        // Osvježi prikaz ako je otvoren neki modal
        if (selectedDate) {
          showTasksForDate(selectedDate);
        }
        
        generateCalendar();
        updateQuickOverview();
      }
    }

    // Prikaz zadataka za odabrani datum
    function showTasksForDate(date) {
      selectedDate = date;
      
      // Formatiramo datum za prikaz
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const formattedDate = date.toLocaleDateString('hr-HR', options);
      document.getElementById('selectedDateText').textContent = formattedDate;
      
      // Filtriranje zadataka za odabrani datum
      const tasksForDate = tasks.filter(task => isSameDay(new Date(task.date), date));
      
      // Prikaz zadataka
      const tasksList = document.getElementById('dateTasksList');
      renderTasksList(tasksForDate, tasksList);
      
      // Otvori modal
      document.getElementById('dateTasksModal').style.display = 'block';
    }

    // Prikaz svih zadataka
    function showAllTasks() {
      const tasksList = document.getElementById('allTasksList');
      renderTasksList(tasks, tasksList);
      document.getElementById('allTasksModal').style.display = 'block';
    }

    // Generička funkcija za renderovanje liste zadataka
    function renderTasksList(tasksArray, container) {
      if (tasksArray.length === 0) {
        container.innerHTML = '<div class="no-tasks"><i class="fas fa-tasks fa-3x"></i><p style="margin-top: 15px;">Nema zadataka za prikaz</p></div>';
        return;
      }

      container.innerHTML = '';
      
      // Sortiraj zadatke po datumu
      tasksArray.sort((a, b) => new Date(a.date) - new Date(b.date)).forEach(task => {
        const taskElement = document.createElement('div');
        taskElement.className = `task-item ${task.completed ? 'completed' : ''}`;
        taskElement.innerHTML = `
          <div class="task-header-row">
            <h3 class="task-title">${task.title}</h3>
            <div class="task-meta">
              <span class="task-priority ${task.priority}">${getPriorityText(task.priority)}</span>
              <span class="task-date">${formatDate(task.date)}</span>
            </div>
          </div>
          ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
          <div class="task-actions">
            <button class="complete-btn" onclick="toggleTaskComplete(${task.id})">
              ${task.completed ? '<i class="fas fa-undo"></i>' : '<i class="fas fa-check"></i>'} ${task.completed ? 'Poništi' : 'Završi'}
            </button>
            <button class="edit-btn" onclick="editTask(${task.id})">
              <i class="fas fa-edit"></i> Uredi
            </button>
            <button class="delete-btn" onclick="deleteTask(${task.id})">
              <i class="fas fa-trash"></i> Obriši
            </button>
          </div>
        `;
        container.appendChild(taskElement);
      });
    }

    // Prikaz statistike
    function showStatistics() {
      const now = new Date();
      
      // Osnovna statistika
      const completedTasks = tasks.filter(t => t.completed).length;
      const activeTasks = tasks.length - completedTasks;
      
      const monthTasks = tasks.filter(t => {
        const d = new Date(t.date);
        return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
      }).length;
      
      document.getElementById('statsTotal').textContent = tasks.length;
      document.getElementById('statsCompleted').textContent = completedTasks;
      document.getElementById('statsActive').textContent = activeTasks;
      document.getElementById('statsMonth').textContent = monthTasks;
      
      // Statistika po prioritetu
      const lowCount = tasks.filter(t => t.priority === 'low').length;
      const mediumCount = tasks.filter(t => t.priority === 'medium').length;
      const highCount = tasks.filter(t => t.priority === 'high').length;
      
      document.getElementById('lowCount').textContent = lowCount;
      document.getElementById('mediumCount').textContent = mediumCount;
      document.getElementById('highCount').textContent = highCount;
      
      // Otvori modal
      document.getElementById('statsModal').style.display = 'block';
    }

    // Ažuriraj brzi pregled
    function updateQuickOverview() {
      const now = new Date();
      
      // Zadaci za danas
      const todayTasks = tasks.filter(t => isSameDay(new Date(t.date), now)).length;
      document.getElementById('todayCount').textContent = todayTasks;
      
      // Zadaci za ovu sedmicu
      const startOfWeek = new Date(now);
      startOfWeek.setDate(now.getDate() - now.getDay() + 1);
      const endOfWeek = new Date(startOfWeek);
      endOfWeek.setDate(startOfWeek.getDate() + 6);
      
      const weekTasks = tasks.filter(t => {
        const taskDate = new Date(t.date);
        return taskDate >= startOfWeek && taskDate <= endOfWeek;
      }).length;
      
      document.getElementById('weekCount').textContent = weekTasks;
      
      // Zadaci za ovaj mjesec
      const monthTasks = tasks.filter(t => {
        const d = new Date(t.date);
        return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
      }).length;
      
      document.getElementById('monthCount').textContent = monthTasks;
      
      // Ukupan broj zadataka
      document.getElementById('totalCount').textContent = tasks.length;
    }

    // Eksport PDF za cijeli mjesec
    function exportMonthPDF() {
      const monthTasks = tasks.filter(t => {
        const d = new Date(t.date);
        return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
      });
      
      const monthNotes = notes.filter(n => {
        const d = new Date(n.date);
        return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
      });

      if (monthTasks.length === 0 && monthNotes.length === 0) {
        alert('Nema zadataka ili bilješki za ovaj mjesec!');
        return;
      }

      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      let yOffset = 10;
      const pageWidth = doc.internal.pageSize.getWidth();
      const margin = 20;

      // Naslov
      doc.setFontSize(20);
      doc.setTextColor(107, 70, 193);
      doc.text("MJESEČNI IZVEŠTAJ", pageWidth / 2, yOffset, { align: 'center' });
      yOffset += 10;

      // Podnaslov
      doc.setFontSize(14);
      doc.setTextColor(85, 85, 85);
      doc.text(`${new Date(currentYear, currentMonth).toLocaleString('hr-HR', { month: 'long', year: 'numeric' })}`, pageWidth / 2, yOffset, { align: 'center' });
      yOffset += 15;

      // Linija ispod naslova
      doc.setDrawColor(107, 70, 193);
      doc.setLineWidth(0.5);
      doc.line(margin, yOffset, pageWidth - margin, yOffset);
      yOffset += 10;

      // Generisanje datuma izveštaja
      const reportDate = new Date().toLocaleDateString('hr-HR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      doc.setFontSize(10);
      doc.setTextColor(100, 100, 100);
      doc.text(`Izveštaj generisan: ${reportDate}`, pageWidth - margin, yOffset, { align: 'right' });
      yOffset += 10;

      // Sekcija za zadatke
      if (monthTasks.length > 0) {
        doc.setFontSize(16);
        doc.setTextColor(107, 70, 193);
        doc.text("ZADACI", margin, yOffset);
        yOffset += 10;
        
        doc.setDrawColor(200, 200, 200);
        doc.setLineWidth(0.2);
        doc.line(margin, yOffset, pageWidth - margin, yOffset);
        yOffset += 5;

        doc.setFontSize(10);
        monthTasks.forEach((task, index) => {
          if (yOffset > 250) {
            doc.addPage();
            yOffset = 20;
          }

          // Naslov zadatka
          doc.setFontSize(12);
          doc.setTextColor(0, 0, 0);
          doc.text(`${index + 1}. ${task.title}`, margin, yOffset);
          yOffset += 7;

          // Metapodaci
          doc.setFontSize(10);
          const status = task.completed ? "✓ Završeno" : "○ Aktivan";
          const priority = getPriorityText(task.priority);
          const taskDate = formatDate(task.date);
          
          doc.setTextColor(100, 100, 100);
          doc.text(`Datum: ${taskDate} | Status: ${status} | Prioritet: ${priority}`, margin, yOffset);
          yOffset += 7;

          // Opis zadatka (ako postoji)
          if (task.description) {
            doc.setTextColor(60, 60, 60);
            const lines = doc.splitTextToSize(`Opis: ${task.description}`, pageWidth - 2 * margin);
            doc.text(lines, margin + 5, yOffset);
            yOffset += (lines.length * 6);
          }

          // Linija između zadataka
          doc.setDrawColor(240, 240, 240);
          doc.line(margin, yOffset + 2, pageWidth - margin, yOffset + 2);
          yOffset += 10;
        });
      }

      // Sekcija za bilješke
      if (monthNotes.length > 0) {
        if (yOffset > 220) {
          doc.addPage();
          yOffset = 20;
        }

        doc.setFontSize(16);
        doc.setTextColor(107, 70, 193);
        doc.text("BILJEŠKE", margin, yOffset);
        yOffset += 10;
        
        doc.setDrawColor(200, 200, 200);
        doc.setLineWidth(0.2);
        doc.line(margin, yOffset, pageWidth - margin, yOffset);
        yOffset += 5;

        doc.setFontSize(10);
        monthNotes.forEach((note, index) => {
          if (yOffset > 250) {
            doc.addPage();
            yOffset = 20;
          }

          // Bilješka
          doc.setFontSize(12);
          doc.setTextColor(0, 0, 0);
          doc.text(`${index + 1}. Bilješka`, margin, yOffset);
          yOffset += 7;

          // Datum bilješke
          doc.setFontSize(10);
          doc.setTextColor(100, 100, 100);
          doc.text(`Datum: ${formatDate(note.date)}`, margin, yOffset);
          yOffset += 7;

          // Tekst bilješke
          if (note.text) {
            doc.setTextColor(60, 60, 60);
            const lines = doc.splitTextToSize(note.text, pageWidth - 2 * margin);
            doc.text(lines, margin + 5, yOffset);
            yOffset += (lines.length * 6);
          }

          // Linija između bilješki
          doc.setDrawColor(240, 240, 240);
          doc.line(margin, yOffset + 2, pageWidth - margin, yOffset + 2);
          yOffset += 10;
        });
      }

      // Statistički podaci na kraju
      if (yOffset > 200) {
        doc.addPage();
        yOffset = 20;
      }

      doc.setFontSize(14);
      doc.setTextColor(107, 70, 193);
      doc.text("STATISTIKA", margin, yOffset);
      yOffset += 10;
      
      doc.setDrawColor(200, 200, 200);
      doc.setLineWidth(0.2);
      doc.line(margin, yOffset, pageWidth - margin, yOffset);
      yOffset += 10;

      doc.setFontSize(11);
      doc.setTextColor(0, 0, 0);
      
      const completedTasks = monthTasks.filter(t => t.completed).length;
      const activeTasks = monthTasks.length - completedTasks;
      
      doc.text(`Ukupan broj zadataka: ${monthTasks.length}`, margin, yOffset);
      yOffset += 7;
      doc.text(`Završeni zadaci: ${completedTasks}`, margin, yOffset);
      yOffset += 7;
      doc.text(`Aktivni zadaci: ${activeTasks}`, margin, yOffset);
      yOffset += 7;
      doc.text(`Broj bilješki: ${monthNotes.length}`, margin, yOffset);
      yOffset += 15;

      // Footer
      doc.setFontSize(10);
      doc.setTextColor(150, 150, 150);
      doc.text("© Kalendar aplikacija - Generirano automatski", pageWidth / 2, 280, { align: 'center' });

      // Sačuvaj PDF
      const monthName = new Date(currentYear, currentMonth).toLocaleString('hr-HR', { month: 'long' });
      doc.save(`Kalendar_${monthName}_${currentYear}.pdf`);
    }

    // Brisanje svih zadataka za trenutni mjesec
    function clearAllMonth() {
      const monthTasks = tasks.filter(t => {
        const d = new Date(t.date);
        return d.getMonth() === currentMonth && d.getFullYear() === currentYear;
      });

      if (monthTasks.length === 0) {
        alert('Nema zadataka za brisanje ovog mjeseca!');
        return;
      }

      if (confirm(`Da li ste sigurni da želite obrisati sve zadatke za ${new Date(currentYear, currentMonth).toLocaleString('hr-HR', { month: 'long' })} ${currentYear}? (Ukupno: ${monthTasks.length} zadataka)`)) {
        tasks = tasks.filter(t => {
          const d = new Date(t.date);
          return !(d.getMonth() === currentMonth && d.getFullYear() === currentYear);
        });
        
        saveTasks();
        generateCalendar();
        updateQuickOverview();
        alert(`Uspješno obrisano ${monthTasks.length} zadataka!`);
      }
    }

    // Pomoćne funkcije
    function saveTasks() {
      localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    function isSameDay(date1, date2) {
      return date1.getDate() === date2.getDate() &&
             date1.getMonth() === date2.getMonth() &&
             date1.getFullYear() === date2.getFullYear();
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('hr-HR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });
    }

    function getPriorityText(priority) {
      const texts = {
        low: 'Nizak',
        medium: 'Srednji',
        high: 'Visok'
      };
      return texts[priority] || priority;
    }

    // Zatvaranje modala klikom izvan
    window.onclick = function(event) {
      const modals = ['taskModal', 'dateTasksModal', 'allTasksModal', 'statsModal'];
      modals.forEach(modalId => {
        const modal = document.getElementById(modalId);
        if (event.target === modal) {
          if (modalId === 'taskModal') closeTaskModal();
          if (modalId === 'dateTasksModal') closeDateTasksModal();
          if (modalId === 'allTasksModal') closeAllTasksModal();
          if (modalId === 'statsModal') closeStatsModal();
        }
      });
    };
  </script>
</body>
</html>